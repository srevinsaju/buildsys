<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>togomak</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="features/introduction.html"><strong aria-hidden="true">2.</strong> Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="features/concurrency.html"><strong aria-hidden="true">2.1.</strong> Concurrency</a></li><li class="chapter-item expanded "><a href="features/dependency.html"><strong aria-hidden="true">2.2.</strong> Dependency Resolution</a></li><li class="chapter-item expanded "><a href="features/interpolation.html"><strong aria-hidden="true">2.3.</strong> Interpolation</a></li><li class="chapter-item expanded "><a href="features/macros.html"><strong aria-hidden="true">2.4.</strong> Reusable Stages</a></li><li class="chapter-item expanded "><a href="features/daemonizing.html"><strong aria-hidden="true">2.5.</strong> Daemonizing</a></li><li class="chapter-item expanded "><a href="features/docker.html"><strong aria-hidden="true">2.6.</strong> Container Support</a></li><li class="chapter-item expanded "><a href="features/outputs.html"><strong aria-hidden="true">2.7.</strong> Outputs</a></li></ol></li><li class="chapter-item expanded "><a href="cli/introduction.html"><strong aria-hidden="true">3.</strong> Command Line Interface</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/usage.html"><strong aria-hidden="true">3.1.</strong> Usage</a></li></ol></li><li class="chapter-item expanded "><a href="configuration/introduction.html"><strong aria-hidden="true">4.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="configuration/togomak.html"><strong aria-hidden="true">4.1.</strong> Togomak</a></li><li class="chapter-item expanded "><a href="configuration/stage.html"><strong aria-hidden="true">4.2.</strong> Stage</a></li><li class="chapter-item expanded "><a href="configuration/locals.html"><strong aria-hidden="true">4.3.</strong> Locals</a></li><li class="chapter-item expanded "><a href="configuration/data.html"><strong aria-hidden="true">4.4.</strong> Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="configuration/data_env.html"><strong aria-hidden="true">4.4.1.</strong> data.env</a></li><li class="chapter-item expanded "><a href="configuration/data_prompt.html"><strong aria-hidden="true">4.4.2.</strong> data.prompt</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.4.3.</strong> data.file</div></li><li class="chapter-item expanded "><a href="configuration/data_git.html"><strong aria-hidden="true">4.4.4.</strong> data.git</a></li></ol></li><li class="chapter-item expanded "><a href="configuration/macro.html"><strong aria-hidden="true">4.5.</strong> Macro</a></li></ol></li><li class="chapter-item expanded "><a href="contrib/plugins/introduction.html"><strong aria-hidden="true">5.</strong> Plugins</a></li><li class="chapter-item expanded "><a href="contributing.html"><strong aria-hidden="true">6.</strong> Contributing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">togomak</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="togomak"><a class="header" href="#togomak">Togomak</a></h1>
<p>Welcome to Togomak, your go-to solution for seamless Continuous Integration and Continuous Deployment (CICD) workflows. Togomak is an open-source, Golang-based CICD system tool that aims to make building and deploying your applications a breeze, no matter where you want to run them.</p>
<h2 id="what-is-togomak"><a class="header" href="#what-is-togomak">What is Togomak?</a></h2>
<p>Togomak is designed to be an abstraction layer for multiple CICD systems, making it easy to run your builds anywhere. Whether you're developing on your local machine or using popular cloud-based platforms like Jenkins or Cloud Build, Togomak has got you covered.</p>
<p>Taking inspiration from Terraform's lifecycle-based system, Togomak offers a structured approach to managing your build processes. Think of it as GNU Make, but with the added power of working across different environments.</p>
<p><code>togomak</code> doesn't aim to be a competitor to other CI/CD systems like GitHub Actions or Jenkins, but in fact extend on them, helping to create a unified place to track builds across all infrastructure, and to make local developers' build and deployment process much easier. Think of it like this: you are an engineer, and having to deal with pipelines spread across GitLab, GitHub or Jenkins is such a pain. And sometimes, you just want to give a shot checking out the fix for a small typo you made, and now you have to wait for an eternity for the CICD pipelines to be green before you can actually test it on your system, because sometimes, development environments get too complicated, and the Cloud would be the ONLY place where the code actually works. Togomak, tries to unify them.</p>
<h2 id="get-started"><a class="header" href="#get-started">Get Started</a></h2>
<p>Ready to simplify your CICD workflows? Follow our detailed <a href="./installation.html">installation guide</a> to get Togomak up and running. Explore our documentation to learn more about its <a href="./features.html">features</a>, <a href="./configuration.html">configuration options</a>, and <a href="./best-practices.html">best practices</a>.</p>
<h2 id="key-features"><a class="header" href="#key-features">Key Features</a></h2>
<h3 id="flexibility-and-extensibility"><a class="header" href="#flexibility-and-extensibility">Flexibility and Extensibility</a></h3>
<p>Togomak supports IPC-based plugins, allowing you to enhance its functionality using Golang or Python. With this capability, you can customize and extend Togomak to suit your specific needs, making it a truly versatile tool for your CICD build systems. Leveraging the power of <code>hashicorp/go-plugin</code>, the same plugin system used by Terraform, Togomak offers extensive configuration capabilities for your CICD build systems. Customize and fine-tune your workflows with ease using this robust and battle-tested plugin system.</p>
<h3 id="declarative-configuration"><a class="header" href="#declarative-configuration">Declarative Configuration</a></h3>
<p>Forget complex configuration setups! Togomak uses a declarative HCL file to define your builds. This makes it straightforward to specify your requirements, ensuring a smooth and hassle-free configuration process. You can now even write your own parsers in any of your favorite languages to write a complex CICD pipeline now. </p>
<h3 id="local-runner-system"><a class="header" href="#local-runner-system">Local Runner System</a></h3>
<p>Togomak's local runner system is designed to run anywhere. You can detach it and execute your builds in your preferred environment, providing the flexibility and convenience you need as a developer. Say goodbye to limitations and run your builds wherever you choose.</p>
<h3 id="remote-tracking-system"><a class="header" href="#remote-tracking-system">Remote Tracking System</a></h3>
<blockquote>
<p>NOTE: this section is planned, and is on the roadmap. See <a href="./roadmap.html">Roadmap</a></p>
</blockquote>
<p>Collaboration made easy! Togomak includes a remote tracking server that securely stores your build logs and triggers builds through a user-friendly UI. Now you can share your build progress and collaborate with ease, whether you're working locally or on the cloud.</p>
<h2 id="whats-with-the-name"><a class="header" href="#whats-with-the-name">What's with the name?</a></h2>
<p>Togomak is a playful fusion of &quot;tokamak&quot; and &quot;to go and make.&quot; &quot;Tokamak&quot; refers to a magnetic plasma holding device used in fusion reactors, symbolizing Togomak's aim to provide a solid framework for managing CICD processes. The implementation of Togomak in Golang represents the &quot;to go and make&quot; aspect, leveraging Golang's simplicity, performance, and concurrency to deliver a powerful and efficient solution for your CICD requirements. Together, these elements embody Togomak's commitment to stability, adaptability, and productivity in the world of CICD.</p>
<h3 id="okay-thats-a-lot-of-talk-how-do-you-pronounce-it-"><a class="header" href="#okay-thats-a-lot-of-talk-how-do-you-pronounce-it-">Okay, that's a lot of talk. How do you pronounce it-</a></h3>
<p>toh-goh-mak. </p>
<p>For the geeky users out there, Togomak is pronounced as &quot;/toʊˈɡoʊˌmæk/.&quot;</p>
<h2 id="contribute"><a class="header" href="#contribute">Contribute</a></h2>
<p>Togomak is an open-source project and welcomes contributions from the community. If you have ideas for new features, bug fixes, or improvements, we'd love to hear from you! Check out our <a href="./contributing.html">contribution guidelines</a> to learn how you can get involved.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="features"><a class="header" href="#features">Features</a></h1>
<ul>
<li><a href="features/./concurrency.html">Concurrency</a></li>
<li><a href="features/./dependency.html">Dependency Resolution</a></li>
<li><a href="features/./macros.html">Reusable Stages</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="concurrency"><a class="header" href="#concurrency">Concurrency</a></h1>
<p>Togomak uses concurrency, by default. The number of stages
run in parallel, is theoritically infinity (see <a href="https://stackoverflow.com/questions/8509152/max-number-of-goroutines">goroutines</a>).
The number of stages run in parallel depends on the <a href="features/./dependency.html">graph</a>
derived from the pipeline. </p>
<p>Say, four stages are completely independent of each of other.
The number of stages run concurrently would be 4.
Similarly, if stage A runs independently, but B, C, D depends 
on A, the maximum number of stages that will run in parallel would 
be 3. </p>
<p>When <code>togomak -n</code> or <code>togomak --dry-run</code> is used, concurrency 
is disabled, so that the command output remains readable. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dependency-resolution"><a class="header" href="#dependency-resolution">Dependency Resolution</a></h1>
<p>togomak uses native dependency resolution, based on references within their attributes. 
Let's take a look at this example:</p>
<pre><code class="language-hcl">stage &quot;alice&quot; {
    script = &quot;echo hello world&quot;
}

stage &quot;bob&quot; {
    script = &quot;echo waiting for ${stage.alice.id}&quot;
}
</code></pre>
<p>In the above example, <code>stage.alice</code> naturally becomes a dependency of <code>stage.bob</code>.
However, you can also explicitly specify dependencies if you would like to:</p>
<pre><code class="language-hcl">
stage &quot;alice&quot; {
    script = &quot;hello world&quot;
}

stage &quot;bob&quot; {
    depends_on = [stage.alice]
    script = &quot;hello bob&quot;
}
</code></pre>
<h2 id="data-evaluation"><a class="header" href="#data-evaluation">Data evaluation</a></h2>
<p><a href="features/../configuration/data.html">Data blocks</a> are lazily evaluated. 
Data blocks will be only evaluated before the stage requiring them, gets
executed. </p>
<pre><code class="language-hcl">stage &quot;bob&quot; {
    script = &quot;echo Hello World&quot;
}

data &quot;env&quot; &quot;bob_name&quot; {
    default = &quot;Bob Ross&quot;
}

stage &quot;alice&quot; {
        script = &quot;echo This is an environment variable: ${data.env.bob_name.value}&quot;
}
</code></pre>
<p>In the above example, the order of execution would be <code>stage.bob</code> and <code>env.bob_name</code> in parallel, and then <code>stage.alice</code>.</p>
<p>If you would like to disable concurrency, and let all the execution happen synchronously and linearly,
you can disable concurrency on <a href="features/../configuration/togomak.html#concurrency"><code>togomak.pipeline.concurrency</code></a> options. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="interpolation"><a class="header" href="#interpolation">Interpolation</a></h1>
<p>String interpolation is a native feature of togomak.
It uses similarly named functions from Terraform, and has a lot of helper scripts
to achieve the same.</p>
<p>Let's take an example:</p>
<pre><code class="language-hcl">
stage &quot;hello_world&quot; {
    script = &quot;echo ${upper('hello world')}&quot;
}
</code></pre>
<p>The above stage prints <code>HELLO WORLD</code> to standard output, thanks to the <a href="features/../functions.html#upper">upper</a>
helper function.</p>
<p>Similarly, you can even do math!</p>
<pre><code class="language-hcl">stage &quot;i_can_calculate&quot; {
    script = &quot;echo 1 plus 2 is ${1 + 2}&quot;
}
</code></pre>
<p>For an incomplete list of functions, take a look at the detailed <a href="features/../functions.html"><code>functions</code></a> page.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reusable-stages"><a class="header" href="#reusable-stages">Reusable Stages</a></h1>
<p>Sometimes, you might have run into a scenario where you would like to 
repeat the same boring task multiple times in the same pipeline. </p>
<p>Your first thought might be a shell script, with custom arguments 
as parameters, but maintaining these pipelines over multiple places
would be a hassle. A single pipeline is already complicated enough in my opinion. </p>
<p><code>togomak</code> provides a feature called <code>macros</code> which are re-usable stages.
You can write a stage once, with a set of parameters, and re-use them 
in multiple stages later. Let's see how:</p>
<pre><code class="language-tf">togomak {
  version = 2
}

macro &quot;explode&quot; {
  stage &quot;explode&quot; {
    script = &lt;&lt;-EOT
        for i in $(seq 1 10); do
          sleep 0.1
          echo &quot;${param.eva}: Loading $i...&quot;
        done

        echo &quot;${param.eva}: entry plug connected! pilot ${param.pilot} synchronized! 🤖&quot;
        EOT
  }
}


stage &quot;entry_plug_eva01&quot; {
  use {
    macro = macro.explode
    parameters = {
      pilot = &quot;Shinji Ikari 🙅‍♂️&quot;
      eva   = &quot;01&quot;
    }
  }
}

stage &quot;entry_plug_eva02&quot; {
  use {
    macro = macro.explode
    parameters = {
      pilot = &quot;Asuka Langley Soryu 🙅‍♀️&quot;
      eva   = &quot;02&quot;
    }
  }
}


</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="daemonizing"><a class="header" href="#daemonizing">Daemonizing</a></h1>
<p>Sometimes, you might want to run a stage in the background, for example, 
an HTTP API server, and continue with multiple integrations tests on 
the same HTTP API server. In another scenario, you might just want 
two live reloading servers for two frontends running in parallel.
Or, maybe you just need a <code>postgres</code> database docker container running.
In these cases, <code>togomak</code> takes care of all the process management 
required for handling these daemon-like long-running process.</p>
<p>Here is a sample use case, directly from <code>togomak</code>'s <code>togomak.hcl</code></p>
<pre><code class="language-hcl">togomak {
  version = 2
}


stage &quot;fmt&quot; {
  script = &quot;go fmt github.com/srevinsaju/togomak/v1/...&quot;
}

stage &quot;vet&quot; {
  script = &quot;go vet github.com/srevinsaju/togomak/v1/...&quot;
}

stage &quot;build&quot; {
  depends_on = [stage.fmt, stage.vet]
  script     = &quot;go build -v -o ./cmd/togomak/togomak github.com/srevinsaju/togomak/v1/cmd/togomak&quot;
}

stage &quot;install&quot; {
  depends_on = [stage.build]
  script     = &quot;go install github.com/srevinsaju/togomak/v1/cmd/togomak&quot;
}

stage &quot;docs_serve&quot; {
  daemon {
    enabled = true
  }
  if     = false
  script = &quot;cd docs &amp;&amp; mdbook serve&quot;
}
</code></pre>
<p>In the above togomak configuration file, the <code>mdbook</code> generator, which 
is used for writing this documentation is allowed to run as a daemon 
process. Similarly, it is possible to have multiple processes running 
as well.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="container-support"><a class="header" href="#container-support">Container Support</a></h1>
<blockquote>
<p><code>podman</code> execution engine is not supported. <code>togomak</code> uses the <code>docker/client</code> SDK
to directly interact with the running docker daemon. </p>
</blockquote>
<p>Togomak has integrated docker container support, a sample usage would be as follows:</p>
<pre><code class="language-hcl">togomak {
  version = 2
}

stage &quot;example&quot; {
  container {
    image = &quot;ubuntu&quot;
    volume {
      source      = &quot;${cwd}/diary&quot;
      destination = &quot;/newdiary&quot;
    }
  }
  script = &lt;&lt;-EOT
  #!/usr/bin/env bash
  ls -al
  for i in $(seq 1 10); do
    sleep 1
    echo &quot;Loading $i...&quot;
  done
  cat rei.diary.txt
  ls -al /newdiary
  EOT
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="outputs"><a class="header" href="#outputs">Outputs</a></h1>
<p>Sometimes, you would want to generate some outputs 
from your build. Sometimes, you might want to store 
the version you parsed from a file, or a list of files 
that you would want to share with another independent 
stage.</p>
<p>To do so, you can write as environment variables to <code>$TOGOMAK_OUTPUTS</code></p>
<p>for example:</p>
<pre><code class="language-hcl">togomak {
  version = 2
}

stage &quot;agent&quot; {
  script = &lt;&lt;-EOT
  set -u
  echo &quot;AGENT=Ryoji Kaji&quot; &gt;&gt; $TOGOMAK_OUTPUTS
  EOT
}

stage &quot;seele&quot; {
  depends_on = [stage.agent]
  name       = &quot;seele&quot;
  script     = &quot;echo The agent from Seele reporting! ${output.AGENT}&quot;
}
</code></pre>
<p>As a limitation, you can only share data within 
the same pipeline scope. i.e, data is not 
implicitly shared between pipelines run using
an remote source, or external file, in the case
of using <code>macros</code> with external files. However,
you can still pass them using <code>macro</code>'s parameters.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-line-interface"><a class="header" href="#command-line-interface">Command Line Interface</a></h1>
<ul>
<li><a href="cli/./cli/usage.html">Usage</a></li>
</ul>
<p>Togomak, internally features three modes of execution:</p>
<ul>
<li><code>ci</code> (<code>--ci</code>)</li>
<li><code>unattended</code> (<code>--unattended</code>)</li>
<li>Normal execution</li>
</ul>
<p>In <code>unattended</code> mode, all prompts and interactive options will be disabled. 
<code>ci</code> mode is same as unattended mode, but however, a separate variable will
be defined in the pipeline <code>togomak.ci</code>, which can be used later to run 
specific stages on CI, and only run certain stages on the user side. </p>
<p>The <code>ci</code> mode is implicit on popular CICD providers like Jenkins, GitHub or 
GitLab CI, etc. It requires one of the environment variables: <code>CI</code>, <code>TOGOMAK_CI</code>
or the CLI flag <code>--ci</code> for it to be enabled.</p>
<p>In the normal execution mode, prompts will pass through the pipeline execution, 
and it will wait indefinitely until the user enters the value.
Similarly, Interrupts will be enabled on the normal execution mode.</p>
<p>On the first <code>Ctrl + C</code> recevied from the user in the normal execution mode, 
it will send <code>SIGTERM</code> to child stages, or will stop the docker container, in the 
case of docker container engines. The deadline in most cases would be 10 seconds.</p>
<p>If a second <code>Ctrl + C</code> is received within the above deadline time, the child processes
will be sent <code>SIGKILL</code> signal. In the case of docker containers, no action will be
taken. This means that, it is possible that containers might be left dangling.
Similarly, it is possible to have zombie processes.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<h2 id="basic-usage"><a class="header" href="#basic-usage">Basic Usage</a></h2>
<p>By default, <code>togomak</code> runs all stages 
which evaluates their condition <code>stage.xxx.if</code> to 
<code>true</code>. By default, all stages evaluate their
condition to true, unless explicitly 
specified. </p>
<p>To simply run all stages which meet the criteria,
just do</p>
<pre><code class="language-bash">togomak 
</code></pre>
<p>and you should be good to go.</p>
<p>If your togomak pipeline lives in a different
directory, you could:</p>
<pre><code class="language-bash">togomak -C path/to/different/dir
</code></pre>
<p>Similary, you can also explicitly specify 
the path to <code>togomak.hcl</code> using the <code>-f</code> or 
the <code>--file</code> parameter.</p>
<h2 id="running-specific-stages"><a class="header" href="#running-specific-stages">Running specific stages</a></h2>
<p>If you would like to run only specific 
stages, instead of the entire pipeline,
you could do something like this:</p>
<pre><code class="language-bash">togomak stage1 stage2 
</code></pre>
<p>This would run both <code>stage1</code>, <code>stage2</code> and 
all the dependencies of <code>stage1</code> and <code>stage2</code>.
That means, if there were a stage <code>stage3</code>
which depends on <code>stage1</code>, then <code>stage3</code> would
also be included in the same pipeline.</p>
<p>Now, you can also blacklist and whitelist 
certain stages. Let us take the specific
example of <code>togomak.hcl</code> which is used
to build togomak itself, at the root of 
this repository:</p>
<pre><code class="language-hcl">togomak {
  version = 2
}


stage &quot;fmt&quot; {
  script = &quot;go fmt github.com/srevinsaju/togomak/v1/...&quot;
}

stage &quot;vet&quot; {
  script = &quot;go vet github.com/srevinsaju/togomak/v1/...&quot;
}

stage &quot;build&quot; {
  depends_on = [stage.fmt, stage.vet]
  script     = &quot;go build -v -o ./cmd/togomak/togomak github.com/srevinsaju/togomak/v1/cmd/togomak&quot;
}

stage &quot;install&quot; {
  depends_on = [stage.build]
  script     = &quot;go install github.com/srevinsaju/togomak/v1/cmd/togomak&quot;
}

stage &quot;docs_serve&quot; {
  daemon {
    enabled = true
  }
  if     = false
  script = &quot;cd docs &amp;&amp; mdbook serve&quot;
}
</code></pre>
<p>In the above example, doing <code>togomak build</code>
would run both <code>stage.build</code> and <code>stage.install</code>.</p>
<p>However, if you would like to run only <code>stage.build</code>
and not <code>stage.install</code>, you could do:</p>
<pre><code class="language-bash">togomak build ^install
</code></pre>
<p>The <code>^</code> operator is used as a blacklist operator.
Similarly, if you would like to add the <code>stage.fmt</code>
along with the stages which run, you would do:</p>
<pre><code class="language-bash">togomak build ^install +fmt
</code></pre>
<p>Here, the <code>+</code> operator, is used as a whitelist operator.
You can add multiple <code>+{stage_name}</code> and <code>^{stage_name}</code>
and togomak would run all the stages which meet the
criteria.</p>
<h3 id="running-a-specific-stage-alone"><a class="header" href="#running-a-specific-stage-alone">Running a specific stage alone</a></h3>
<p>If you strictly want to run a single stage,
and do not want to include its dependencies,
or if you do not want to manually blacklist 
all its dependencies, <code>togomak</code> has a 
special stage called the <code>root</code> stage,
which will run regardless of the whitelist or the 
blacklist.</p>
<p>So, if you would like to run only <code>stage.build</code>
and not <code>stage.install</code>, you could do:</p>
<pre><code class="language-bash">togomak root +build
</code></pre>
<p>This translates to:</p>
<ul>
<li>Run only the <code>root</code> stage (and its dependencies, which are <code>nil</code>)</li>
<li>Whitelist <code>build</code> stage</li>
</ul>
<blockquote>
<p>Adding multiple whitelist and blacklist entries
for the same stage will take no effect. The first
entry will be considered and the rest will be ignored.</p>
</blockquote>
<h4 id="whitlisting-stages-from-a-macro"><a class="header" href="#whitlisting-stages-from-a-macro">Whitlisting stages from a macro</a></h4>
<p>If you would like to whitelist stages from a macro,
you could do so by using the <code>+</code> operator.</p>
<pre><code class="language-bash">togomak macro_name.build
</code></pre>
<p>or </p>
<pre><code class="language-bash">togomak macro_name.root +macro_name.build
</code></pre>
<p>and so on.</p>
<h2 id="daemonize-stages"><a class="header" href="#daemonize-stages">Daemonize stages</a></h2>
<blockquote>
<p>Experimental feature, use with caution.</p>
</blockquote>
<p>If you would like to run a stage in the background,
you could do so by adding the <code>&amp;</code> operator to the
stage name.</p>
<pre><code class="language-bash">togomak &amp;build
</code></pre>
<p>This would run the <code>build</code> stage in the background,
and will not wait for the build stage to complete
before moving on to the next stage. However, 
the <code>build</code> stage will be terminated once the last
dependent of the <code>build</code> stage completes.</p>
<p>Under the hood, the <code>build</code> stage will receive
a <code>SIGTERM</code> signal, and will be given a grace period
of 10 seconds to complete. If the stage does not
terminate within the grace period, it will be
forcefully killed (<code>SIGKILL</code>).</p>
<p>The above feature is particularly useful for 
running long running stages, such as a docker 
service for performing integration tests.</p>
<p>For extensive information about the daemonizing
feature, refer to the <a href="cli/../features/daemonizing.html">daemonizing</a> 
section.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="togomak-1"><a class="header" href="#togomak-1">Togomak</a></h1>
<p>The <code>togomak</code> block is a mandatory 
block for the file to be recognized as a valid
<code>togomak</code> pipeline. </p>
<pre><code class="language-hcl"># togomak.hcl

togomak {
    # ...
    version = 2
}
</code></pre>
<p>The above block, with <code>version</code> parameter 
is required for any pipeline to be considered
&quot;runnable&quot;.</p>
<h2 id="arguments-reference"><a class="header" href="#arguments-reference">Arguments Reference</a></h2>
<ul>
<li><a href="configuration/togomak.html#version"><code>version</code></a> - The version of the Togomak pipeline file</li>
</ul>
<h2 id="attributes-reference"><a class="header" href="#attributes-reference">Attributes Reference</a></h2>
<ul>
<li><a href="configuration/togomak.html#version"><code>version</code></a> - The version of the Togomak runner executable</li>
<li><a href="configuration/togomak.html#boot_time"><code>boot_time</code></a> - The time at which the Togomak runner executable was started</li>
<li><a href="configuration/togomak.html#boot_time_unix"><code>boot_time_unix</code></a> - The time at which the Togomak runner executable was started, in unix format</li>
<li><a href="configuration/togomak.html#pipeline_id"><code>pipeline_id</code></a> - The unique identifier for the pipeline run (uuid)</li>
<li><a href="configuration/togomak.html#pipeline_id"><code>ci</code></a> - Returns <code>true</code> if togomak is running on a CI environment, like GitHub Actions or Jenkins, etc.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stage"><a class="header" href="#stage">Stage</a></h1>
<p>A <code>stage</code> is considered as an atomic runnable
unit. Multiple stages may be executed 
concurrently. </p>
<p>A stage can accept a script, a command and a set 
of arguments, or a macro. </p>
<h3 id="stage-with-script"><a class="header" href="#stage-with-script">Stage with Script</a></h3>
<pre><code class="language-hcl"><span class="boring">togomak {
</span><span class="boring">  version = 2
</span><span class="boring">}
</span><span class="boring">
</span>stage &quot;script&quot; {
  script = &quot;echo 'Hello World'&quot;
}
</code></pre>
<h3 id="stage-with-command-and-arguments"><a class="header" href="#stage-with-command-and-arguments">Stage with Command and Arguments</a></h3>
<pre><code class="language-hcl"><span class="boring">togomak {
</span><span class="boring">  version = 2
</span><span class="boring">}
</span><span class="boring">
</span>stage &quot;command&quot; {
  args = [&quot;echo&quot;, &quot;Hello World&quot;]
}
</code></pre>
<h3 id="stage-with-macro"><a class="header" href="#stage-with-macro">Stage with Macro</a></h3>
<pre><code class="language-hcl"><span class="boring">togomak {
</span><span class="boring">  version = 2
</span><span class="boring">}
</span><span class="boring">
</span>macro &quot;echo&quot; {
  stage &quot;echo&quot; {
    args = [&quot;echo&quot;, &quot;Hello World&quot;]
  }
}

stage &quot;macro&quot; {
  use {
    macro = macro.echo     
  }
}
</code></pre>
<h3 id="stage-with-dependencies"><a class="header" href="#stage-with-dependencies">Stage with Dependencies</a></h3>
<pre><code class="language-hcl"><span class="boring">togomak {
</span><span class="boring">  version = 2
</span><span class="boring">}
</span><span class="boring">
</span>stage &quot;build&quot; {
  script = &quot;echo 'Building'&quot;
}

stage &quot;install&quot; {
  depends_on = [stage.build]
  script = &quot;echo 'Installing'&quot;
}
</code></pre>
<h3 id="stage-with-retry"><a class="header" href="#stage-with-retry">Stage with Retry</a></h3>
<pre><code class="language-hcl"><span class="boring">togomak {
</span><span class="boring">  version = 2
</span><span class="boring">}
</span><span class="boring">
</span>stage &quot;build&quot; {
  script = &lt;&lt;-EOT
  echo this script will fail
  exit 1
  EOT
  retry {
    enabled = true
    attempts = 3
    exponential_backoff = true
    min_backoff = 1
    max_backoff = 10
  }
}
</code></pre>
<h2 id="stage-with-containers"><a class="header" href="#stage-with-containers">Stage with Containers</a></h2>
<pre><code class="language-hcl">togomak {
  version = 2
}

stage &quot;example&quot; {
  container {
    image = &quot;ubuntu&quot;
    volume {
      source      = &quot;${cwd}/diary&quot;
      destination = &quot;/newdiary&quot;
    }
  }
  script = &lt;&lt;-EOT
  #!/usr/bin/env bash
  ls -al
  for i in $(seq 1 10); do
    sleep 1
    echo &quot;Loading $i...&quot;
  done
  cat rei.diary.txt
  ls -al /newdiary
  EOT
}
</code></pre>
<h2 id="stage-with-daemons-with-lifecycle-rules"><a class="header" href="#stage-with-daemons-with-lifecycle-rules">Stage with daemons, with lifecycle rules</a></h2>
<pre><code class="language-hcl">{{#include ../../../examples/daemon-until/togomak.hcl}}
</code></pre>
<h2 id="arguments-reference-1"><a class="header" href="#arguments-reference-1">Arguments Reference</a></h2>
<ul>
<li>
<p><a href="configuration/stage.html#name"><code>name</code></a> - The name of the stage</p>
</li>
<li>
<p><a href="configuration/stage.html#if"><code>if</code></a> - The condition to be evaluated before running the stage</p>
</li>
<li>
<p><a href="configuration/stage.html#use"><code>use</code></a> - Macro, or a provider that could be used. Structure is <a href="configuration/stage.html#use">documented below</a></p>
</li>
<li>
<p><a href="configuration/stage.html#depends_on"><code>depends_on</code></a> - The stages which this stage depends on.</p>
</li>
<li>
<p><a href="configuration/stage.html#container"><code>container</code></a> - The container to be used to run the stage. Structure is <a href="configuration/stage.html#container">documented below</a></p>
</li>
<li>
<p><a href="configuration/stage.html#script"><code>script</code></a> - The script to be executed</p>
</li>
<li>
<p><a href="configuration/stage.html#args"><code>args</code></a> - The command and arguments to be executed</p>
</li>
<li>
<p><a href="configuration/stage.html#retry"><code>retry</code></a> - Stage retry configuration. Structure is <a href="configuration/stage.html#retry">documented below</a></p>
</li>
<li>
<p><a href="configuration/stage.html#daemon"><code>daemon</code></a> - Daemon specific configuration. Structure is <a href="configuration/stage.html#daemon">documented below</a></p>
</li>
</ul>
<hr />
<p><a id="use"></a>
The <code>use</code> block supports:</p>
<ul>
<li><a href="configuration/stage.html#macro"><code>macro</code></a> - The macro to be used</li>
</ul>
<hr />
<p><a id="retry"></a>
The <code>retry</code> block supports:</p>
<ul>
<li><a href="configuration/stage.html#enabled"><code>enabled</code></a> - Whether the stage should be retried, defaults to <code>false</code></li>
<li><a href="configuration/stage.html#attempts"><code>attempts</code></a> - The number of times the stage should be retried</li>
<li><a href="configuration/stage.html#exponential_backoff"><code>exponential_backoff</code></a> - Whether the backoff should be exponential</li>
<li><a href="configuration/stage.html#min_backoff"><code>min_backoff</code></a> - The minimum backoff time (in seconds)</li>
<li><a href="configuration/stage.html#max_backoff"><code>max_backoff</code></a> - The maximum backoff time (in seconds)</li>
</ul>
<hr />
<p><a id="container"></a>
The <code>container</code> block supports:</p>
<ul>
<li><a href="configuration/stage.html#image"><code>image</code></a> - The container image to be used</li>
</ul>
<hr />
<p><a id="daemon"></a></p>
<blockquote>
<p>Daemonization is still wip, see <a href="configuration/../features/daemonizing.html">daemonization</a> for more information on availability </p>
</blockquote>
<p>The <code>daemon</code> block supports:</p>
<ul>
<li><a href="configuration/stage.html#enabled"><code>enabled</code></a> - Whether the stage should be run as a daemon, defaults to <code>false</code></li>
<li><a href="configuration/stage.html#timeout"><code>timeout</code></a> - Time to wait until the stage is terminated, in seconds. Defaults to 0 (no timeout).</li>
<li><a href="configuration/stage.html#lifecycle"><code>lifecycle</code></a> - Set of rules which decide if the daemon needs to be terminated, or not. Structure <a href="configuration/stage.html#lifecycle">documented below</a></li>
</ul>
<hr />
<p><a id="lifecycle"></a></p>
<ul>
<li>[<code>stop_when_complete</code>] - Array of stages. <code>togomak</code> waits for all the stages mentioned in the <code>stop_when_complete</code> argument, before sending <code>SIGTERM</code> to the daemon process</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="locals"><a class="header" href="#locals">Locals</a></h1>
<p>If you plan to use a specific variable several times in your pipeline, you may use 
a <code>locals {}</code> block. </p>
<p>A simple usage may be shown below</p>
<pre><code class="language-hcl">locals {
    var1 = 1
    var2 = &quot;hello&quot;
    var3 = {
        apple = 2
        orange = 3
    }
}
</code></pre>
<p>When referring to them in stages, use <code>local.&lt;variable_name&gt;</code>, for example:</p>
<pre><code class="language-hcl">togomak {
  version = 2
}

locals {
  nerv_headquarters = &quot;Tokyo-3&quot;
  pilot_name        = &quot;Shinji&quot;
}

stage &quot;eva01_synchronization&quot; {
  name   = &quot;Eva-01 Synchronization Tests&quot;
  script = &quot;echo ${local.pilot_name} is now running synchronization tests at ${local.nerv_headquarters}&quot;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data"><a class="header" href="#data">Data</a></h1>
<p>The <code>data</code> block allows fetching static data from different sources known 
as <code>data_providers</code>. Common providers include examples like environment variables,
file sources, or an external secrets manager, like Hashicorp Vault or Google 
Secret Manager. </p>
<p>A basic <code>data</code> block looks like this:</p>
<pre><code class="language-hcl">data &quot;provider_name&quot; &quot;id&quot; {
    ...
    default = &quot;???&quot;
}
</code></pre>
<p>Here, the data block uses the provider, <code>provider_name</code> to retrieve information.
The retrieved value will be stored, and can be accessed <code>data.provider_name.id.value</code>.</p>
<h2 id="data-providers"><a class="header" href="#data-providers">Data Providers</a></h2>
<h3 id="built-in-providers"><a class="header" href="#built-in-providers">Built-in providers</a></h3>
<p>Parameters for the <code>data</code> block depends on the type of the provider. 
Supported buit-in providers are:</p>
<ul>
<li><a href="configuration/./data_env.html"><code>data.env</code></a>: Environment Variable Provider </li>
<li><a href="configuration/./data_prompt.html"><code>data.prompt</code></a>: Interactive user CLI prompt </li>
<li><a href="configuration/./data_file.html"><code>data.file</code></a>: Read data from a file</li>
</ul>
<p>Refer to the documentation by the provider type, for more information
on the supported attributes.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dataenv"><a class="header" href="#dataenv"><code>data.env</code></a></h1>
<p>The <code>env</code> data provider fetches the variable from the environment
before the execution of the pipeline happens. If the specified 
environment variable is undefined, falls back to the <code>default</code>
value specified in the <code>data.env</code> block, else returns an empty 
string.</p>
<h2 id="reading-an-environment-variable"><a class="header" href="#reading-an-environment-variable">Reading an environment variable</a></h2>
<pre><code class="language-hcl">data &quot;env&quot; &quot;user&quot; {
  key = &quot;USER&quot;
  default = &quot;me&quot;
}
</code></pre>
<h2 id="arguments-reference-2"><a class="header" href="#arguments-reference-2">Arguments Reference</a></h2>
<ul>
<li><a href="configuration/data_env.html#key"><code>key</code></a>: The environment variable key which needs to be fetched from <code>os.environ</code></li>
<li><a href="configuration/data_env.html#default"><code>default</code></a>: Fallback definition, which will be returned if <code>os.environ[key]</code> is undefined. </li>
</ul>
<h2 id="attributes-reference-1"><a class="header" href="#attributes-reference-1">Attributes Reference</a></h2>
<ul>
<li>[<code>value</code>]: The value from the environment variable defined in <code>key</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dataprompt"><a class="header" href="#dataprompt"><code>data.prompt</code></a></h1>
<p>If you interactively need to ask user for an input, you may use 
the <code>prompt</code> data source. 
The <code>prompt</code> data source interactively asks for the user 
on the Command line interface, if the TTY supports it, or
asks the user on the Web UI (not implemented yet).</p>
<p>It is very likely that, depending on the execution engine, 
<code>data.prompt</code> resources are placed at the beginning of the 
topological sorted layer to prevent interference from other 
running stages (in the case of CLIs), or in the case of 
Web UIs to collect all data in the beginning of pipeline 
execution, so that it can happen asynchronously. </p>
<h2 id="prompting-a-user-for-response"><a class="header" href="#prompting-a-user-for-response">Prompting a user for response</a></h2>
<pre><code class="language-hcl">data &quot;prompt&quot; &quot;name&quot; {
    prompt = &quot;what is your name?&quot;
    default = &quot;John Doe&quot;
}
</code></pre>
<h2 id="argument-reference"><a class="header" href="#argument-reference">Argument Reference</a></h2>
<ul>
<li><a href="configuration/data_prompt.html#prompt"><code>prompt</code></a> - The data that the user will be prompted for (optional)</li>
<li><a href="configuration/data_prompt.html#default"><code>default</code></a> - Fallback data which will be returned if the user did not enter anything, or if the 
TTY is absent, or if any other UI provider is missing. (optional)</li>
</ul>
<h2 id="attributes-reference-2"><a class="header" href="#attributes-reference-2">Attributes Reference</a></h2>
<ul>
<li><a href="configuration/data_prompt.html#value"><code>value</code></a> - The response from the user, otherwise the <code>default</code> value will be returned.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="datagit"><a class="header" href="#datagit"><code>data.git</code></a></h1>
<p>The <code>git</code> data provider clones a git repository
to a specific directory</p>
<h3 id="opening-the-existing-repository"><a class="header" href="#opening-the-existing-repository">Opening the existing repository</a></h3>
<pre><code class="language-hcl">data &quot;git&quot; &quot;this&quot; {
  url = &quot;.&quot;
}
</code></pre>
<h3 id="cloning-a-new-repository"><a class="header" href="#cloning-a-new-repository">Cloning a new repository</a></h3>
<pre><code class="language-hcl">togomak {
  version = 2
}

data &quot;git&quot; &quot;repo&quot; {
  url   = &quot;https://github.com/srevinsaju/togomak&quot;
  files = [&quot;togomak.hcl&quot;]
}

stage &quot;example&quot; {
  name   = &quot;example&quot;
  script = &lt;&lt;-EOT
  echo '${data.git.repo.files[&quot;togomak.hcl&quot;]}'
  EOT

}
</code></pre>
<h3 id="reusing-remote-stages-using-togomak"><a class="header" href="#reusing-remote-stages-using-togomak">Reusing remote stages, using togomak</a></h3>
<pre><code class="language-hcl">togomak {
  version = 2
}

data &quot;git&quot; &quot;eva01_source&quot; {
  url   = &quot;https://github.com/srevinsaju/togomak&quot;
  files = [&quot;togomak.hcl&quot;]
}

macro &quot;gendo_brain&quot; {
  files = data.git.eva01_source.files
}

stage &quot;build_eva01&quot; {
  name = &quot;Building eva unit&quot;
  use {
    macro = macro.gendo_brain
  }

} 
</code></pre>
<h2 id="arguments-reference-3"><a class="header" href="#arguments-reference-3">Arguments Reference</a></h2>
<ul>
<li><a href="configuration/data_git.html#url"><code>url</code></a> - The URL of the repository to clone.</li>
<li><a href="configuration/data_git.html#tag"><code>tag</code></a> - The tag to checkout. <code>tag</code> takes precedence over <code>branch</code>.</li>
<li><a href="configuration/data_git.html#ref"><code>ref</code></a> - The reference to checkout, in the format <code>refs/tags/v3</code> for example. <code>ref</code> takes precedence over <code>tag</code> and <code>branch</code>.</li>
<li><a href="configuration/data_git.html#branch"><code>branch</code></a> - The branch to checkout. <code>ref</code> and <code>tag</code> takes precedence over <code>branch</code>.</li>
<li><a href="configuration/data_git.html#destination"><code>destination</code></a> - The destination directory to clone the repository to, defaults to <code>&quot;memory&quot;</code>, which clones into a temporary directory managed by <code>togomak</code></li>
<li><a href="configuration/data_git.html#commit"><code>commit</code></a> - The commit to checkout.</li>
<li><a href="configuration/data_git.html#depth"><code>depth</code></a> - The depth of the clone.</li>
<li><a href="configuration/data_git.html#ca_bundle"><code>ca_bundle</code></a> - The path to a CA bundle file or directory, (deprecated, does nothing).</li>
<li><a href="configuration/data_git.html#auth"><code>auth</code></a> - The authentication credentials to use when cloning the repository. Structure <a href="configuration/data_git.html#auth">documented below</a></li>
<li><a href="configuration/data_git.html#files"><code>files</code></a> - The files to checkout from the repository. Accepts an array of file paths.</li>
</ul>
<h2 id="attributes-reference-3"><a class="header" href="#attributes-reference-3">Attributes Reference</a></h2>
<ul>
<li><a href="configuration/data_git.html#last-tag"><code>last_tag</code></a> - The latest tag in the repository, defaults to <code>&quot;&quot;</code></li>
<li><a href="configuration/data_git.html#commits-since-last-tag"><code>commits_since_last_tag</code></a> - The number of commits since the last tag, defaults to <code>0</code></li>
<li><a href="configuration/data_git.html#sha"><code>sha</code></a> - The SHA of the commit, defaults to <code>&quot;&quot;</code></li>
<li><a href="configuration/data_git.html#ref"><code>ref</code></a> - The ref of the commit, in the format <code>refs/heads/&lt;branch&gt;</code> or <code>refs/tags/&lt;tag&gt;</code>, defaults to <code>&quot;&quot;</code></li>
<li><a href="configuration/data_git.html#is-tag"><code>is_tag</code></a> - Whether the ref is a tag, defaults to <code>false</code></li>
<li><a href="configuration/data_git.html#files"><code>files</code></a> - The files checked out from the repository. Returns a map, with the keys being the file paths and the values being the file contents.</li>
<li><a href="configuration/data_git.html#branch"><code>branch</code></a> - The branch checked out from the repository. Returns a string.</li>
<li><a href="configuration/data_git.html#destination"><code>destination</code></a> - The destination where the repository is stored. </li>
</ul>
<hr />
<p><a id="auth"></a>
The <code>auth</code> block supports:</p>
<ul>
<li><a href="configuration/data_git.html#username"><code>username</code></a> - The username to be used. If password is specified, and if the username is empty, it falls back to <code>oauth2</code></li>
<li><a href="configuration/data_git.html#password"><code>password</code></a> - The password to be used for connecting to the private repository. </li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="macro"><a class="header" href="#macro">Macro</a></h1>
<p>Macros are reusable stages. If you would like to reuse the same stage multiple times 
in the same pipeline, with optionally different parameters, <code>macros</code> are the right 
thing for you.</p>
<p>You may use <code>macro</code> in three ways:</p>
<ul>
<li><strong>Inline stages</strong> (<code>stage</code> block): The stage is defined in the macro block, and re-used multiple times</li>
<li><strong>External files</strong> (<code>source</code> argument): Path to an external single pipeline located on the filesystem, which will
be passed to an internal togomak child process, which will independently run the single file as a separate stage. 
See <a href="configuration/../features/macros.html">Reusable Stages section</a> for more information.</li>
<li><strong>Pipeline content</strong> (<code>files</code> argument): A map containing files inline, which will be used by togomak, to create 
another child process which will run the contents of the file, as an independant stage. </li>
</ul>
<h3 id="example-usage-inline-stages"><a class="header" href="#example-usage-inline-stages">Example usage (Inline stages)</a></h3>
<pre><code class="language-tf">togomak {
  version = 2
}

macro &quot;explode&quot; {
  stage &quot;explode&quot; {
    script = &lt;&lt;-EOT
        for i in $(seq 1 10); do
          sleep 0.1
          echo &quot;${param.eva}: Loading $i...&quot;
        done

        echo &quot;${param.eva}: entry plug connected! pilot ${param.pilot} synchronized! 🤖&quot;
        EOT
  }
}


stage &quot;entry_plug_eva01&quot; {
  use {
    macro = macro.explode
    parameters = {
      pilot = &quot;Shinji Ikari 🙅‍♂️&quot;
      eva   = &quot;01&quot;
    }
  }
}

stage &quot;entry_plug_eva02&quot; {
  use {
    macro = macro.explode
    parameters = {
      pilot = &quot;Asuka Langley Soryu 🙅‍♀️&quot;
      eva   = &quot;02&quot;
    }
  }
}


</code></pre>
<h2 id="argument-reference-1"><a class="header" href="#argument-reference-1">Argument reference</a></h2>
<ul>
<li><a href="configuration/macro.html#stage"><code>stage</code></a> - The stage that will be reused, optional. Structure <a href="configuration/macro.html#stage">documented below</a></li>
<li><a href="configuration/macro.html#source"><code>source</code></a> - Path to a different togomak file, which will be recursively invoked.</li>
<li><a href="configuration/macro.html#files"><code>files</code></a> - a map containing key value pairs of file paths to file content. Map <a href="configuration/macro.html#files">documented below</a></li>
</ul>
<hr />
<p><a href="configuration/stage"></a>
The <code>stage</code> block supports:</p>
<ul>
<li>All features under the <a href="configuration/../stage.html"><code>stage</code></a>, except <code>id</code>, <code>name</code>, <code>description</code></li>
</ul>
<hr />
<p><a href="configuration/files"></a>
The <code>files</code> is a map, which accepts data in the format of key-value pairs, where the &quot;key&quot; is the path to the file 
and the &quot;value&quot; is the content of the file. </p>
<p>For example,</p>
<pre><code class="language-hcl">files = {
    &quot;togomak.hcl&quot; = &lt;&lt;-EOT
    togomak {
        version = 2
    }
    stage &quot;hello&quot; {
        script = &quot;echo hello world&quot;
    }
    EOT,
    ...
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plugins"><a class="header" href="#plugins">Plugins</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contributing"><a class="header" href="#contributing">Contributing</a></h1>
<p>Contributions are welcome, and encouraged. 
All contributions are licensed under the <a href="https://github.com/srevinsaju/togomak/blob/v1/LICENSE">MPL License v2.0</a></p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="contributing.html#contribution-workflow">Contribution Workflow</a></li>
<li><a href="contributing.html#commit-guidelines">Commit Guidelines</a></li>
<li><a href="contributing.html#documentation">Documentation</a></li>
<li><a href="contributing.html#code-formatting">Code Formatting</a></li>
<li><a href="contributing.html#testing">Testing</a></li>
<li><a href="contributing.html#pull-requests">Pull Requests</a></li>
<li><a href="contributing.html#code-of-conduct">Code of Conduct</a></li>
<li><a href="contributing.html#license">License</a></li>
</ul>
<h2 id="contribution-workflow"><a class="header" href="#contribution-workflow">Contribution Workflow</a></h2>
<ul>
<li>Fork the repository to your GitHub account.</li>
<li>Clone the forked repository to your local machine.</li>
<li>Create a new branch for your feature or bug fix: <code>git checkout -b feature-name</code>.</li>
<li>Make your changes, following the project's coding style and guidelines.</li>
<li>Commit your changes using Conventional Commit standards (see guidelines below).</li>
<li>Push your branch to your forked repository: <code>git push origin feature-name</code>.</li>
<li>Open a pull request against the main repository's <code>v1</code> branch.</li>
</ul>
<h2 id="commit-guidelines"><a class="header" href="#commit-guidelines">Commit Guidelines</a></h2>
<p>We follow the Conventional Commit standard for our commit messages. 
This standard helps us maintain a clean and informative commit history. 
Each commit message should have the following format:</p>
<pre><code>&lt;type&gt;: &lt;description&gt;

[optional body]

[optional footer]
</code></pre>
<p>Here are some examples of commit message types:</p>
<ul>
<li><strong>feat</strong>: A new feature implementation.</li>
<li><strong>fix</strong>: A bug fix.</li>
<li><strong>docs</strong>: Documentation changes.</li>
<li><strong>refactor</strong>: Code refactoring.</li>
<li><strong>test</strong>: Adding or modifying tests.</li>
<li><strong>chore</strong>: General maintenance tasks (build system updates, dependency management, etc.).</li>
</ul>
<p>Please make sure to provide a clear and concise description in the commit message. If additional information is necessary, feel free to include a body section or refer to relevant issues or pull requests.</p>
<h2 id="documentation"><a class="header" href="#documentation">Documentation</a></h2>
<p>It is important to keep the project's documentation up-to-date. Any changes or additions made to the code should be reflected in the relevant documentation files. If you make any modifications that affect the project's usage or behavior, please update the documentation accordingly.
We use <a href="https://github.com/rust-lang/mdBook"><code>mdbook</code></a> to generate the documentation.
You can start a live server to preview your changes by running <code>mdbook serve</code> in the <code>docs</code> directory, or
by using <code>togomak root +docs_serve</code> command.</p>
<h2 id="code-formatting"><a class="header" href="#code-formatting">Code Formatting</a></h2>
<p>To maintain a consistent code style, please run <code>go fmt</code> on your Go code before committing. This command automatically formats your code according to the standard Go formatting guidelines.
Or just run <code>togomak</code> from time to time.</p>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<p>Before submitting your changes, please ensure that all existing tests pass and add new tests when appropriate. Running the test suite helps to verify the correctness and stability of the codebase.</p>
<h2 id="pull-requests"><a class="header" href="#pull-requests">Pull Requests</a></h2>
<p>When submitting a pull request, please adhere to the following guidelines:</p>
<ol>
<li>Provide a clear and descriptive title for the pull request.</li>
<li>Include a summary of the changes made and the motivation behind them.</li>
<li>Reference any relevant issues or pull requests in the description.</li>
<li>Make sure your code is properly formatted and documented.</li>
<li>Verify that all tests pass successfully.</li>
<li>Assign the pull request to the appropriate reviewer(s).</li>
<li>Be prepared to address feedback and make any necessary changes.</li>
</ol>
<h2 id="code-of-conduct"><a class="header" href="#code-of-conduct">Code of Conduct</a></h2>
<p>Please note that by participating in this project, you are expected to abide by <a href="https://docs.github.com/en/site-policy/github-terms/github-community-code-of-conduct">GitHub's Code of Conduct</a>.
Be respectful and considerate towards others, and help create a welcoming and inclusive environment for everyone involved.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>By contributing to this project, you agree that your contributions will be licensed under the project's <a href="https://github.com/srevinsaju/togomak/blob/v1/LICENSE">LICENSE</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="js/terraform.js"></script>
        <script src="js/init.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
