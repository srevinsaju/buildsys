version: 1

options:
  fail-lazy: true

matrix:
  myAttribute:
    - foo
    - bar

providers:
  - id: git

stages:
  - id: failing-test
    name: Failing Test
    description: This stage should not fail since fail-fast is set to false, but must create a warning
    script: |
      echo "This is a failing test, running on fake {{ matrix.myAttribute }}"
      exit 1

  - id: container-test
    name: Container Test
    description: Test if togomak is able to pull a container from the container registry and execute it
    container: python:alpine
    args:
      - python
      - --version

  - id: concurrency-test-1
    name: Concurrency Test 1
    description: Check if concurrency is supported, concurrency-test-{1, 2, 3} must execute in parallel
    depends-on:
      - container-test
    script: | 
      for i in {1..3}; do
        echo "Concurrency Test $i"
        sleep 1
      done

  - id: concurrency-test-2
    name: Concurrency Test 2
    description: Concurrency and extends test
    extends: .concurrency-test-1

  - id: provider 
    name: Provider Test 
    script: | 
      echo "The commit sha is {{ provider.git.sha }}" 

